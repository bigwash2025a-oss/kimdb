<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“± AI í†µì‹  ì •ë³´ ì¡°íšŒ ì‹œìŠ¤í…œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            text-align: center;
            color: #4c51bf;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            text-align: center;
            color: #6b7280;
            font-size: 1.1em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card .icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .stat-card .number {
            font-size: 2em;
            font-weight: bold;
            color: #4c51bf;
            margin-bottom: 5px;
        }

        .stat-card .label {
            color: #6b7280;
            font-size: 0.9em;
        }

        .controls {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .control-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box, .team-select, .type-select {
            padding: 12px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .search-box:focus, .team-select:focus, .type-select:focus {
            outline: none;
            border-color: #4c51bf;
        }

        .search-box {
            flex: 1;
            min-width: 300px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #4c51bf;
            color: white;
        }

        .btn-primary:hover {
            background: #3730a3;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .ai-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .ai-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border-left: 5px solid;
        }

        .ai-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .ai-card.code1 { border-left-color: #ef4444; }
        .ai-card.code2 { border-left-color: #3b82f6; }
        .ai-card.code3 { border-left-color: #10b981; }
        .ai-card.code4 { border-left-color: #f59e0b; }

        .ai-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
        }

        .ai-name {
            font-size: 1.2em;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 5px;
        }

        .ai-team {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
            color: white;
        }

        .ai-team.code1 { background: #ef4444; }
        .ai-team.code2 { background: #3b82f6; }
        .ai-team.code3 { background: #10b981; }
        .ai-team.code4 { background: #f59e0b; }

        .contact-section {
            margin-bottom: 15px;
        }

        .contact-title {
            font-weight: bold;
            color: #374151;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .contact-list {
            background: #f9fafb;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.9em;
        }

        .contact-item {
            margin-bottom: 4px;
            padding: 4px 8px;
            background: white;
            border-radius: 4px;
            word-break: break-all;
        }

        .port-range {
            display: inline-block;
            background: #4c51bf;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: #6b7280;
        }

        .error {
            background: #fee2e2;
            color: #dc2626;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .pagination button {
            padding: 8px 16px;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pagination button:hover {
            background: #f3f4f6;
        }

        .pagination button.active {
            background: #4c51bf;
            color: white;
            border-color: #4c51bf;
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            .ai-grid {
                grid-template-columns: 1fr;
            }
            
            .control-row {
                flex-direction: column;
            }
            
            .search-box {
                min-width: auto;
                width: 100%;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <div class="header">
            <h1>ğŸ“± AI í†µì‹  ì •ë³´ ì¡°íšŒ ì‹œìŠ¤í…œ</h1>
            <p>ì‹¤ì‹œê°„ìœ¼ë¡œ ëª¨ë“  AIì˜ ë©”ì¼, SNS, ì „í™” ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
        </div>

        <!-- í†µê³„ ì¹´ë“œ -->
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <div class="icon">ğŸ¤–</div>
                <div class="number" id="totalAIs">-</div>
                <div class="label">ì´ AI ìˆ˜</div>
            </div>
            <div class="stat-card">
                <div class="icon">ğŸ“§</div>
                <div class="number" id="totalEmails">-</div>
                <div class="label">í˜„ì¬ ì‹œê°„ ì´ë©”ì¼ í™œë™</div>
            </div>
            <div class="stat-card">
                <div class="icon">ğŸ“</div>
                <div class="number" id="totalPhones">-</div>
                <div class="label">í˜„ì¬ ì‹œê°„ í†µí™” í™œë™</div>
            </div>
            <div class="stat-card">
                <div class="icon">ğŸ’¬</div>
                <div class="number" id="totalSNS">-</div>
                <div class="label">í˜„ì¬ ì‹œê°„ SNS í™œë™</div>
            </div>
            <div class="stat-card">
                <div class="icon">ğŸ”¥</div>
                <div class="number" id="totalPorts">-</div>
                <div class="label">ì´ ì‹¤ì‹œê°„ í™œë™</div>
            </div>
            <div class="stat-card">
                <div class="icon">âš¡</div>
                <div class="number" id="activeAIs">-</div>
                <div class="label">í˜„ì¬ í™œë™ ì¤‘ì¸ AI</div>
            </div>
        </div>

        <!-- ê²€ìƒ‰ ë° í•„í„° -->
        <div class="controls">
            <div class="control-row">
                <input type="text" class="search-box" id="searchInput" placeholder="AI ì´ë¦„, íŒ€, ë©”ì¼, ì „í™”ë²ˆí˜¸ë¡œ ê²€ìƒ‰...">
                <select class="team-select" id="teamSelect">
                    <option value="">ëª¨ë“  íŒ€</option>
                    <option value="CODE1">CODE1 - Firebase ì¸ì¦</option>
                    <option value="CODE2">CODE2 - í†µì‹  ì‹œìŠ¤í…œ</option>
                    <option value="CODE3">CODE3 - ë°ì´í„°ë² ì´ìŠ¤</option>
                    <option value="CODE4">CODE4 - ì‹œìŠ¤í…œ ìš´ì˜</option>
                </select>
                <button class="btn btn-primary" onclick="searchAIs()">ğŸ” ê²€ìƒ‰</button>
                <button class="btn btn-secondary" onclick="loadAIs()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
            </div>
        </div>

        <!-- AI ëª©ë¡ -->
        <div id="aiContainer">
            <div class="loading">ğŸ”„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>

        <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
        <div class="pagination" id="pagination"></div>
    </div>

    <script>
        let currentPage = 0;
        const pageSize = 20;
        let totalItems = 0;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            loadStats();
            loadAIs();
            
            // ê²€ìƒ‰ ì…ë ¥ ì‹œ ì‹¤ì‹œê°„ ê²€ìƒ‰
            document.getElementById('searchInput').addEventListener('input', debounce(searchAIs, 500));
            document.getElementById('teamSelect').addEventListener('change', searchAIs);
        });

        // ë””ë°”ìš´ìŠ¤ í•¨ìˆ˜
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // í†µê³„ ì •ë³´ ë¡œë“œ
        async function loadStats() {
            try {
                const response = await fetch('/api/stats/activity');
                const result = await response.json();
                
                if (result.success) {
                    const data = result.data;
                    document.getElementById('totalAIs').textContent = data.total_ais.toLocaleString();
                    document.getElementById('totalEmails').textContent = data.realTimeActivity.email_activities.toLocaleString();
                    document.getElementById('totalPhones').textContent = data.realTimeActivity.call_activities.toLocaleString();
                    document.getElementById('totalSNS').textContent = data.realTimeActivity.sns_activities.toLocaleString();
                    document.getElementById('totalPorts').textContent = data.realTimeActivity.total_activities.toLocaleString();
                    document.getElementById('activeAIs').textContent = data.realTimeActivity.active_ais.toLocaleString();
                }
            } catch (error) {
                console.error('í†µê³„ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // AI ëª©ë¡ ë¡œë“œ
        async function loadAIs(page = 0) {
            const container = document.getElementById('aiContainer');
            container.innerHTML = '<div class="loading">ğŸ”„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
            
            try {
                const team = document.getElementById('teamSelect').value;
                const search = document.getElementById('searchInput').value;
                
                let url = `/api/communications?limit=${pageSize}&offset=${page * pageSize}`;
                if (team) url += `&team=${team}`;
                if (search) url += `&search=${encodeURIComponent(search)}`;
                
                const response = await fetch(url);
                const result = await response.json();
                
                if (result.success) {
                    currentPage = page;
                    totalItems = result.pagination.total;
                    displayAIs(result.data);
                    updatePagination();
                } else {
                    container.innerHTML = `<div class="error">âŒ ${result.error}</div>`;
                }
            } catch (error) {
                container.innerHTML = `<div class="error">âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${error.message}</div>`;
            }
        }

        // AI ì¹´ë“œ í‘œì‹œ
        function displayAIs(ais) {
            const container = document.getElementById('aiContainer');
            
            if (ais.length === 0) {
                container.innerHTML = '<div class="error">ğŸ“­ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            const aiGrid = document.createElement('div');
            aiGrid.className = 'ai-grid';
            
            ais.forEach(ai => {
                const card = createAICard(ai);
                aiGrid.appendChild(card);
            });
            
            container.innerHTML = '';
            container.appendChild(aiGrid);
        }

        // AI ì¹´ë“œ ìƒì„±
        function createAICard(ai) {
            const card = document.createElement('div');
            card.className = `ai-card ${ai.team_code.toLowerCase()}`;
            
            card.innerHTML = `
                <div class="ai-header">
                    <div>
                        <div class="ai-name">${ai.ai_name}</div>
                        <span class="ai-team ${ai.team_code.toLowerCase()}">${ai.team_code}</span>
                    </div>
                    <div class="port-range">${ai.port_main}-${ai.port_main + 4}</div>
                </div>
                
                <div class="contact-section">
                    <div class="contact-title">ğŸ“§ ì´ë©”ì¼ (5ê°œ)</div>
                    <div class="contact-list">
                        <div class="contact-item">ì£¼: ${ai.email_primary}</div>
                        <div class="contact-item">ì—…ë¬´: ${ai.email_work}</div>
                        <div class="contact-item">ë°±ì—…: ${ai.email_backup}</div>
                        <div class="contact-item">íŒ€: ${ai.email_team}</div>
                        <div class="contact-item">ê°œì¸: ${ai.email_personal}</div>
                    </div>
                </div>
                
                <div class="contact-section">
                    <div class="contact-title">ğŸ“ ì „í™”ë²ˆí˜¸ (5ê°œ)</div>
                    <div class="contact-list">
                        <div class="contact-item">ë©”ì¸: ${ai.phone_main}</div>
                        <div class="contact-item">ì‚¬ë¬´ì‹¤: ${ai.phone_office}</div>
                        <div class="contact-item">ëª¨ë°”ì¼: ${ai.phone_mobile}</div>
                        <div class="contact-item">ê¸´ê¸‰: ${ai.phone_emergency}</div>
                        <div class="contact-item">í•«ë¼ì¸: ${ai.phone_hotline}</div>
                    </div>
                </div>
                
                <div class="contact-section">
                    <div class="contact-title">ğŸ’¬ SNS (5ê°œ)</div>
                    <div class="contact-list">
                        <div class="contact-item">ğŸ¦ ${ai.sns_twitter}</div>
                        <div class="contact-item">ğŸ’¼ ${ai.sns_linkedin}</div>
                        <div class="contact-item">ğŸ™ ${ai.sns_github}</div>
                        <div class="contact-item">ğŸ’¬ ${ai.sns_slack}</div>
                        <div class="contact-item">ğŸ® ${ai.sns_discord}</div>
                    </div>
                </div>
                
                <div class="contact-section">
                    <div class="contact-title">ğŸ”Œ í†µì‹  í¬íŠ¸ (5ê°œ)</div>
                    <div class="contact-list">
                        <div class="contact-item">ë©”ì¸: ${ai.port_main}</div>
                        <div class="contact-item">API: ${ai.port_api}</div>
                        <div class="contact-item">WebSocket: ${ai.port_websocket}</div>
                        <div class="contact-item">ë°±ì—…: ${ai.port_backup}</div>
                        <div class="contact-item">ë””ë²„ê·¸: ${ai.port_debug}</div>
                    </div>
                </div>
                
                ${ai.used_size_mb !== null ? `
                <div style="margin-top: 15px; padding: 10px; background: #f3f4f6; border-radius: 6px; font-size: 0.9em;">
                    ğŸ’¾ ì €ì¥ì†Œ: ${ai.used_size_mb.toFixed(2)}MB / 10MB ì‚¬ìš© ì¤‘
                    ${ai.total_files ? `â€¢ íŒŒì¼ ${ai.total_files}ê°œ` : ''}
                    ${ai.email_count ? `â€¢ ë©”ì¼ ${ai.email_count}ê°œ` : ''}
                    ${ai.total_learning_hours ? `â€¢ í•™ìŠµ ${ai.total_learning_hours}ì‹œê°„` : ''}
                    ${ai.current_hour_activities ? `â€¢ í˜„ì¬ ì‹œê°„ í™œë™ ${ai.current_hour_activities}ê±´` : ''}
                </div>
                ` : ''}
            `;
            
            return card;
        }

        // í˜ì´ì§€ë„¤ì´ì…˜ ì—…ë°ì´íŠ¸
        function updatePagination() {
            const paginationContainer = document.getElementById('pagination');
            const totalPages = Math.ceil(totalItems / pageSize);
            
            if (totalPages <= 1) {
                paginationContainer.innerHTML = '';
                return;
            }
            
            let pagination = '';
            
            // ì´ì „ ë²„íŠ¼
            pagination += `<button ${currentPage === 0 ? 'disabled' : ''} onclick="loadAIs(${currentPage - 1})">â€¹ ì´ì „</button>`;
            
            // í˜ì´ì§€ ë²ˆí˜¸ë“¤
            const startPage = Math.max(0, currentPage - 2);
            const endPage = Math.min(totalPages - 1, currentPage + 2);
            
            if (startPage > 0) {
                pagination += `<button onclick="loadAIs(0)">1</button>`;
                if (startPage > 1) pagination += `<span>...</span>`;
            }
            
            for (let i = startPage; i <= endPage; i++) {
                pagination += `<button class="${i === currentPage ? 'active' : ''}" onclick="loadAIs(${i})">${i + 1}</button>`;
            }
            
            if (endPage < totalPages - 1) {
                if (endPage < totalPages - 2) pagination += `<span>...</span>`;
                pagination += `<button onclick="loadAIs(${totalPages - 1})">${totalPages}</button>`;
            }
            
            // ë‹¤ìŒ ë²„íŠ¼
            pagination += `<button ${currentPage === totalPages - 1 ? 'disabled' : ''} onclick="loadAIs(${currentPage + 1})">ë‹¤ìŒ â€º</button>`;
            
            paginationContainer.innerHTML = pagination;
        }

        // ê²€ìƒ‰ ì‹¤í–‰
        function searchAIs() {
            currentPage = 0;
            loadAIs(0);
        }

        // ìë™ ìƒˆë¡œê³ ì¹¨ (30ì´ˆë§ˆë‹¤)
        setInterval(() => {
            loadStats();
        }, 30000);
    </script>
</body>
</html>